# Extract histogram data and create ECDFs for all 8 datasets
# Data extracted from histogram images

# Dataset 1: mSerf_16S_C01
# Error rates from ~0.0004 to 0.010
breaks_16S <- seq(0.000, 0.010, length.out = 21)
counts_16S <- c(0, 10, 20, 40, 75, 100, 150, 200, 270, 310, 370, 400, 450, 490, 500, 520, 500, 500, 500, 550)
mids_16S <- breaks_16S[-1] - diff(breaks_16S)[1]/2
data_16S <- rep(mids_16S, counts_16S)

# Dataset 2: mSerf_23S_C01
# Error rates from ~0.001 to 0.010
breaks_23S <- seq(0.001, 0.010, length.out = 21)
counts_23S <- c(5, 10, 20, 40, 70, 100, 160, 240, 300, 350, 400, 440, 470, 500, 500, 540, 520, 490, 490, 480)
mids_23S <- breaks_23S[-1] - diff(breaks_23S)[1]/2
data_23S <- rep(mids_23S, counts_23S)

# Dataset 3: mSA1_rrn_C01
# Error rates from ~0.007 to 0.014
breaks_SA1 <- seq(0.007, 0.014, length.out = 21)
counts_SA1 <- c(5, 5, 10, 10, 20, 40, 50, 90, 120, 170, 200, 280, 380, 390, 540, 620, 700)
counts_SA1 <- c(counts_SA1, rep(0, 21-length(counts_SA1)))
mids_SA1 <- breaks_SA1[-1] - diff(breaks_SA1)[1]/2
data_SA1 <- rep(mids_SA1, counts_SA1)

# Dataset 4: mSA2_rrn_C01
# Error rates from ~0.007 to 0.015
breaks_SA2 <- seq(0.007, 0.015, length.out = 21)
counts_SA2 <- c(5, 5, 10, 15, 30, 50, 70, 100, 150, 230, 320, 350, 450, 500, 590)
counts_SA2 <- c(counts_SA2, rep(0, 21-length(counts_SA2)))
mids_SA2 <- breaks_SA2[-1] - diff(breaks_SA2)[1]/2
data_SA2 <- rep(mids_SA2, counts_SA2)

# Dataset 5: mSZ1_rrn_C01
# Error rates from ~0.007 to 0.015
breaks_SZ1 <- seq(0.007, 0.015, length.out = 21)
counts_SZ1 <- c(5, 10, 15, 20, 30, 50, 80, 120, 150, 200, 250, 340, 400, 480, 590, 650, 700, 750)
counts_SZ1 <- c(counts_SZ1, rep(0, 21-length(counts_SZ1)))
mids_SZ1 <- breaks_SZ1[-1] - diff(breaks_SZ1)[1]/2
data_SZ1 <- rep(mids_SZ1, counts_SZ1)

# Dataset 6: mSZ2_rrn_C01
# Error rates from ~0.007 to 0.015
breaks_SZ2 <- seq(0.007, 0.015, length.out = 21)
counts_SZ2 <- c(5, 5, 10, 15, 25, 40, 50, 80, 120, 170, 210, 280, 420, 500, 560, 650)
counts_SZ2 <- c(counts_SZ2, rep(0, 21-length(counts_SZ2)))
mids_SZ2 <- breaks_SZ2[-1] - diff(breaks_SZ2)[1]/2
data_SZ2 <- rep(mids_SZ2, counts_SZ2)

# Dataset 7: mKB_rrn_C01
# Error rates from ~0.0085 to 0.010
breaks_C01 <- seq(0.0085, 0.0100, length.out = 16)
counts_C01 <- c(5, 10, 20, 40, 80, 150, 280, 440, 560, 780, 1020, 1360, 1640, 1800, 2200)
mids_C01 <- breaks_C01[-1] - diff(breaks_C01)[1]/2
data_C01 <- rep(mids_C01, counts_C01)

# Dataset 8: mKB_rrn_C11
# Error rates from ~0.0075 to 0.010
breaks_C11 <- seq(0.0075, 0.0100, length.out = 21)
counts_C11 <- c(10, 20, 50, 100, 300, 1000, 3500, 6000, 9500, 13500, 16000, 16500, 16000, 14500, 0, 0, 0, 0, 0, 0)
mids_C11 <- breaks_C11[-1] - diff(breaks_C11)[1]/2
data_C11 <- rep(mids_C11, counts_C11)

# Create a 2x4 panel plot with all ECDFs
par(mfrow = c(2, 4), mar = c(4, 4, 3, 1), oma = c(0, 0, 2, 0))

# Plot 1: mSerf_16S_C01
plot(ecdf(data_16S), 
     main = "mSerf_16S_C01",
     xlab = "Error Rate",
     ylab = "F(x)",
     col = "blue",
     lwd = 2,
     cex.main = 1,
     cex.lab = 0.9)
abline(v = 0.008, col = "red", lty = 2, lwd = 1)
grid()

# Plot 2: mSerf_23S_C01
plot(ecdf(data_23S), 
     main = "mSerf_23S_C01",
     xlab = "Error Rate",
     ylab = "F(x)",
     col = "blue",
     lwd = 2,
     cex.main = 1,
     cex.lab = 0.9)
abline(v = 0.008, col = "red", lty = 2, lwd = 1)
grid()

# Plot 3: mSA1_rrn_C01
plot(ecdf(data_SA1), 
     main = "mSA1_rrn_C01",
     xlab = "Error Rate",
     ylab = "F(x)",
     col = "darkgreen",
     lwd = 2,
     cex.main = 1,
     cex.lab = 0.9)
abline(v = 0.008, col = "red", lty = 2, lwd = 1)
grid()

# Plot 4: mSA2_rrn_C01
plot(ecdf(data_SA2), 
     main = "mSA2_rrn_C01",
     xlab = "Error Rate",
     ylab = "F(x)",
     col = "darkgreen",
     lwd = 2,
     cex.main = 1,
     cex.lab = 0.9)
abline(v = 0.008, col = "red", lty = 2, lwd = 1)
grid()

# Plot 5: mSZ1_rrn_C01
plot(ecdf(data_SZ1), 
     main = "mSZ1_rrn_C01",
     xlab = "Error Rate",
     ylab = "F(x)",
     col = "darkgreen",
     lwd = 2,
     cex.main = 1,
     cex.lab = 0.9)
abline(v = 0.008, col = "red", lty = 2, lwd = 1)
grid()

# Plot 6: mSZ2_rrn_C01
plot(ecdf(data_SZ2), 
     main = "mSZ2_rrn_C01",
     xlab = "Error Rate",
     ylab = "F(x)",
     col = "darkgreen",
     lwd = 2,
     cex.main = 1,
     cex.lab = 0.9)
abline(v = 0.008, col = "red", lty = 2, lwd = 1)
grid()

# Plot 7: mKB_rrn_C01
plot(ecdf(data_C01), 
     main = "mKB_rrn_C01",
     xlab = "Error Rate",
     ylab = "F(x)",
     col = "purple",
     lwd = 2,
     cex.main = 1,
     cex.lab = 0.9)
abline(v = 0.008, col = "red", lty = 2, lwd = 1)
grid()

# Plot 8: mKB_rrn_C11
plot(ecdf(data_C11), 
     main = "mKB_rrn_C11",
     xlab = "Error Rate",
     ylab = "F(x)",
     col = "purple",
     lwd = 2,
     cex.main = 1,
     cex.lab = 0.9)
abline(v = 0.008, col = "red", lty = 2, lwd = 1)
grid()

mtext("Empirical Cumulative Distribution Functions of Error Rates", 
      outer = TRUE, cex = 1.2, font = 2)

# Reset plotting parameters
par(mfrow = c(1, 1))

# Create comparison plot with all datasets
par(mar = c(5, 4, 4, 2))
plot(ecdf(data_16S), 
     col = "blue", lwd = 2,
     xlim = c(0, 0.015),
     main = "Comparison of Error Rate ECDFs",
     xlab = "Error Rate",
     ylab = "Cumulative Probability",
     cex.main = 1.3)
lines(ecdf(data_23S), col = "cyan", lwd = 2)
lines(ecdf(data_SA1), col = "darkgreen", lwd = 2)
lines(ecdf(data_SA2), col = "green", lwd = 2)
lines(ecdf(data_SZ1), col = "orange", lwd = 2)
lines(ecdf(data_SZ2), col = "darkorange", lwd = 2)
lines(ecdf(data_C01), col = "purple", lwd = 2)
lines(ecdf(data_C11), col = "red", lwd = 2)

abline(v = 0.008, col = "gray30", lty = 2, lwd = 2)
text(0.008, 0.05, "0.008", pos = 4, col = "gray30")

legend("bottomright", 
       legend = c("Sereika 16S", "Sereika 23S", 
                  "Srinivas SA1", "Srinivas SA2",
                  "Srinivas SZ1", "Srinivas SZ2",
                  "Simulated C01", "Simulated C11"),
       col = c("blue", "cyan", "darkgreen", "green", 
               "orange", "darkorange", "purple", "red"),
       lwd = 2,
       cex = 0.8,
       bg = "white")

grid()

# Summary statistics
cat("\n=== Summary Statistics ===\n\n")

datasets <- list(
  "Sereika 16S" = data_16S,
  "Sereika 23S" = data_23S,
  "Srinivas SA1" = data_SA1,
  "Srinivas SA2" = data_SA2,
  "Srinivas SZ1" = data_SZ1,
  "Srinivas SZ2" = data_SZ2,
  "Simulated C01" = data_C01,
  "Simulated C11" = data_C11
)

for (name in names(datasets)) {
  data <- datasets[[name]]
  cat(sprintf("%-16s: n=%5d, median=%.5f, mean=%.5f, P(ER<0.008)=%.3f\n",
              name, 
              length(data),
              median(data),
              mean(data),
              mean(data < 0.008)))
}
